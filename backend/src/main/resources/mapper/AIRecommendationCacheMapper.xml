<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.travel.agent.mapper.AIRecommendationCacheMapper">

    <insert id="insertJsonb"
            parameterType="com.travel.agent.entity.AIRecommendationCache"
            useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO ai_recommendations
        (
            user_id,
            session_id,
            intent_hash,
            mood,
            keywords,
            preferred_features,
            budget_level,
            estimated_duration,
            recommendations,
            created_at,
            expires_at
        )
        VALUES
        (
            #{userId},
            #{sessionId},
            #{intentHash},
            #{mood},
            #{keywords},
            #{preferredFeatures},
            #{budgetLevel},
            #{estimatedDuration},
            CAST(#{recommendations,typeHandler=com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler} AS jsonb),
            #{createdAt},
            #{expiresAt}
        )
    </insert>

</mapper>
